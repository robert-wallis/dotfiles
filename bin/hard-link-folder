#!/bin/bash
# Copyright 2012 Robert Wallis All Rights Reserved
# Licence: GNU LGPL

validate_input()
{
	# source
	if [ $1 -a -d $1 ];
	then
		let nop=1
	else
		printf "%b" "source folder " ${1} " invalid\n"
		printf "%b" "usage: $0 [source folder] [destination folder]\n"
		exit 1
	fi
	# destination
	if [ $2 -a -d $2 ];
	then
		let nop=1
	else
		if [ -e $2 ];
		then
			# the destination is not a directory
			printf "%b" "destination folder $1 invalid\n"
			printf "%b" "usage: $0 [source folder] [destination folder]\n"
			exit 1
		else
			# the destination doesn't exist yet, make it
			mkdir -p $2
		fi
	fi
}

link_files()
{
	ls -l1 $1 |
	while read FILE
	do
		if [ -d "${1}${FILE}" ];
		then
			printf "Skipping directory ${FILE}\n"
		else
			# hardlink the files
			ln -f "${1}${FILE}" "${2}${FILE}"
		fi
	done
}

validate_input $1 $2
link_files $1 $2
